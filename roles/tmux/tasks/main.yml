---
- name: "Install tmux"
  pacman:
    name: "tmux"
    state: "present"
  become: yes

- name: "Copy tmux configuration"
  template:
    src: "tmux.conf.j2"
    dest: "~/.tmux.conf"
    mode: "0600"

- name: "Install tmux plugin manager"
  git:
    repo: "{{ tmux_plugin_repo }}"
    dest: "{{ tmux_plugin_dest }}"
    clone: yes
    update: yes

- name: "Install plugins"
  command: "{{ tmux_plugin_dest }}/bin/install_plugins"
  changed_when: tpm_install_result.stdout.find(tmux_plugin_installation_message) != -1
  register: tpm_install_result

- name: "Update tmux plugins"
  command: "{{ tmux_plugin_dest }}/bin/update_plugins all"
  failed_when: tpm_install_result.stderr != ""
  changed_when: false
  register: tpm_update_result

- name: "Create folder for systemd tmux"
  file:
    path: "{{ systemd_user_directory }}/tmux.service.d"
    state: "directory"
  when: tmux_continuum == 'on'

- name: "Copy tmux overriding configuration for systemd"
  template:
    src: "override.conf.j2"
    dest: "{{ systemd_user_directory }}/tmux.service.d/override.conf"
    mode: "0600"
  when: tmux_continuum == 'on'
  notify: "Reload systemctl daemon"
