---
- name: "create folder for symlinks from {{ src }}"
  file:
    path: "~/.{{ src }}"
    state: directory
  become_user: "{{ user_name }}"
  when: create_directory

- name: "get files on {{ src }}"
  shell: "ls {{ dotfiles_dest }}/{{ src.split('/') | last }}/*"
  become_user: "{{ user_name }}"
  changed_when: false
  register: path_files

- name: "symlink files from {{ src }}"
  file:
    src: "{{ item }}"
    dest: "~/{{ create_directory | ternary(['.',src,'/']|join(''), '.') }}{{ item | basename }}"
    state: link
  with_items: "{{ path_files.stdout_lines }}"
  become_user: "{{ user_name }}"
