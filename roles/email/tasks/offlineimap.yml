---
- name: "install offlineimap to sync emails and ca-certificates"
  pacman:
    name: "{{ item }}"
    state: "present"
  with_items:
    - "offlineimap"
    - "ca-certificates"
  become: yes

- name: "create folder for offlineimap configuration and mail"
  file:
    path: "{{ item }}"
    state: "directory"
  with_items:
    - "{{ offlineimap_directory }}"
    - "{{ email_directory }}"

- name: "copy offlineimap configuration file"
  template:
    src: "offlineimap/config.j2"
    dest: "{{ offlineimap_directory }}/config"
    mode: "0600"

- name: "enable and start offlineimap timer"
  systemd:
    name: "offlineimap-oneshot.timer"
    state: "started"
    enabled: yes
    user: yes
