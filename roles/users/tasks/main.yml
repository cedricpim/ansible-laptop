---
- name: create initial groups
  group:
    name: "{{ item }}"
    state: present
  with_items: "{{ users_groups }}"

- name: create user "{{ user_name }}"
  user:
    name: "{{ user_name }}"
    password: "{{ user_password }}"
    createhome: yes
    groups: "{{ users_groups }}"
    append: yes
    state: present
