---
- name: "Install File Manager related packages"
  pacman:
    name:
      - "ranger"
      - "atool"
      - "highlight"
      - "mediainfo"
      - "ffmpegthumbnailer"
      - "w3m"
      - "udiskie"
    state: "present"
  become: yes

- name: "Check ranger_icons plugin status"
  stat:
    path: "{{ ranger_directory }}/plugins/devicons.py"
  register: ranger_devicon_stat

- name: "Download & install ranger_icons repository"
  block:
    - tempfile: suffix="ranger" state="directory"
      register: tempdir
    - git: repo="{{ ranger_icons_repo }}" dest="{{ tempdir.path }}" clone=yes
    - command: "make install"
      args:
        chdir: "{{ tempdir.path }}"
  always:
    - file: path="{{ tempdir.path }}" state="absent"
  when:
    - ranger_devicon_stat is defined
    - ranger_devicon_stat.stat.islnk is not defined

- name: "Create folder for ranger configuration"
  file:
    path: "{{ ranger_directory }}"
    state: "directory"
    mode: "0700"

- name: "Copy ranger configuration"
  template:
    src: "ranger/{{ item }}.j2"
    dest: "{{ ranger_directory }}/{{ item }}"
    mode: "0600"
  with_items:
    - "commands.py"
    - "commands_full.py"
    - "rc.conf"
    - "rifle.conf"
    - "scope.sh"

- name: "Create folder for ranger colorschemes"
  file:
    path: "{{ ranger_directory }}/colorschemes"
    state: "directory"
    mode: "0700"

- name: "Copy ranger colorschemes"
  template:
    src: "ranger/colorschemes/dark.py.j2"
    dest: "{{ ranger_directory }}/colorschemes/dark.py"
    mode: "0600"
