---
- name: "Install File Manager related packages"
  pacman:
    name:
      - "ranger"
      - "atool"
      - "highlight"
      - "mediainfo"
      - "ffmpegthumbnailer"
      - "w3m"
      - "udiskie"
    state: "present"
  become: yes

- name: "Check ranger_icons plugin status"
  stat:
    path: "{{ ranger_directory }}/plugins/devicons.py"
  register: ranger_devicon_stat

- name: "Download & install ranger_icons repository"
  block:
    - tempfile: suffix="ranger" state="directory"
      register: tempdir
    - git: repo="{{ ranger_icons_repo }}" dest="{{ tempdir.path }}" clone=yes
    - command: "make install"
      args:
        chdir: "{{ tempdir.path }}"
  always:
    - file: path="{{ tempdir.path }}" state="absent"
  when:
    - ranger_devicon_stat is defined
    - ranger_devicon_stat.stat.islnk is not defined

- name: "Create folder for ranger configuration"
  file:
    path: "{{ ranger_directory }}"
    state: "directory"
    mode: "0700"

- name: "Copy ranger configuration"
  template:
    src: "ranger/{{ item.name }}.j2"
    dest: "{{ ranger_directory }}/{{ item.name }}"
    mode: "{{ item.mode }}"
  with_items:
    - { name: "commands.py",      mode: "0600" }
    - { name: "commands_full.py", mode: "0600" }
    - { name: "rc.conf",          mode: "0600" }
    - { name: "rifle.conf",       mode: "0600" }
    - { name: "scope.sh",         mode: "0700" }

- name: "Create folder for ranger colorschemes"
  file:
    path: "{{ ranger_directory }}/colorschemes"
    state: "directory"
    mode: "0700"

- name: "Copy ranger colorschemes"
  template:
    src: "ranger/colorschemes/dark.py.j2"
    dest: "{{ ranger_directory }}/colorschemes/dark.py"
    mode: "0600"
