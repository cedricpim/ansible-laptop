---
- name: "Install Bluetooth related packages"
  pacman:
    name:
      - "bluez"
      - "bluez-utils"
      - "bluez-libs"
      - "bluez-hid2hci"
      - "pulseaudio-bluetooth"
    state: "present"
  become: yes

- include_role:
    name: "yay"
  vars:
    pkg_name: "blueman"

- name: "Add auto-connect to pulse"
  lineinfile:
    path: "/etc/pulse/default.pa"
    regexp: 'load-module module-switch-on-connect'
    line: "load-module module-switch-on-connect"
  become: yes

- name: "Allow 'wheel' group to call rfkill"
  lineinfile:
    path: "/etc/sudoers"
    regexp: '%wheel ALL=\(ALL\) NOPASSWD: /usr/bin/rfkill'
    line: "%wheel ALL=(ALL) NOPASSWD: /usr/bin/rfkill"
    validate: "visudo -cf %s"
    backup: yes
  become: yes

- name: "Enable/start service for bluetooth"
  systemd:
    name: "bluetooth"
    state: "started"
    enabled: yes
  become: yes
