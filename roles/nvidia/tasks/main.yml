---
- name: "Install graphic's related packages"
  pacman:
    name:
      - "xorg-xinit"
      - "xorg-setxkbmap"
      - "xorg-xrandr"
      - "mesa"
      - "xf86-video-intel"
      - "nvidia"
      - "bbswitch"
      - "ntfs-3g"
    state: "present"
  become: yes

- name: "Install acpilight package"
  pacman:
    name: "acpilight"
    state: "present"
  become: yes

- name: "Add video group to users"
  user:
    name: "{{ item.name }}"
    groups: "video"
    append: yes
    state: "present"
  with_items: "{{ users }}"
  loop_control:
    label: "{{ item.name }}"
  become: yes

- name: "Install bumblebee package"
  pacman:
    name: "bumblebee"
    state: "present"
  become: yes

- name: "Add bumblebee group to users"
  user:
    name: "{{ item.name }}"
    groups: "bumblebee"
    append: yes
    state: "present"
  with_items: "{{ users }}"
  loop_control:
    label: "{{ item.name }}"
  become: yes

- name: "Start service for bumblebee"
  systemd:
    name: "bumblebeed"
    state: started
    enabled: yes
  become: yes
