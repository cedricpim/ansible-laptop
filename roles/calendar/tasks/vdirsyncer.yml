---
- include_role:
    name: pacaur_package
  vars:
    pkg_name: vdirsyncer

- name: create folder for vdirsyncer configuration
  file:
    path: "{{ vdirsyncer_directory }}"
    state: directory

- name: copy vdirsyncer credentials
  copy:
    src: "vdirsyncer/pass.gpg"
    dest: "{{ vdirsyncer_directory }}/pass.gpg"
    mode: 0600

- name: copy vdirsyncer configuration
  template:
    src: "vdirsyncer/config.j2"
    dest: "{{ vdirsyncer_directory }}/config"
    mode: 0600

- name: create folder for systemd
  file:
    path: "{{ systemd_user_directory }}"
    state: directory

- name: symlink service and timer for vdirsyncer
  file:
    src: "{{ vdirsyncer_aur_systemd }}/{{ item }}"
    dest: "{{ systemd_user_directory }}/{{ item }}"
    state: link
  with_items:
    - vdirsyncer.service
    - vdirsyncer.timer
  notify: updated vdirsyncer timer

- name: create folder for systemd vdirsyncer
  file:
    path: "{{ systemd_user_directory }}/vdirsyncer.service.d"
    state: directory

- name: copy vdirsyncer overriding configuration for systemd
  template:
    src: "vdirsyncer/override.conf.j2"
    dest: "{{ systemd_user_directory }}/vdirsyncer.service.d/override.conf"
    mode: 0600
  notify: updated vdirsyncer timer
