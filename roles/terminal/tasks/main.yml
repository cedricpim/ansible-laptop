---
- name: install urxvt and python-psutil (for dconf)
  pacman:
    name: "{{ item }}"
    state: present
  with_items:
    - "rxvt-unicode-terminfo"
    - "python-psutil"
  become: yes

- include_role:
    name: pacaur_package
  vars:
    pkg_name: rxvt-unicode-patched

- name: create folder for urxvt icon
  file:
    path: "{{ urxvt_icon_dest }}"
    state: directory

- name: copy urxvt icon
  copy:
    src: urxvt.png
    dest: "{{ urxvt_icon_dest }}"
    mode: 0644

- name: create folder for urxvt extra configurations
  file:
    path: "{{ urxvt_directory }}"
    state: directory

- name: copy urxvt extra configurations
  template:
    src: "{{ item.file }}.j2"
    dest: "{{ urxvt_directory }}/{{ item.file }}"
    mode: "{{ item.mode }}"
  with_items:
    - { file: "colorscheme", mode: "0600" }
    - { file: "urxvtopen", mode: "0700" }

- name: Set global shortcut for urxvt
  dconf:
    key: "{{ urxvt_dconf_shortcut_base_key }}{{ item.key }}"
    value: "{{ item.value }}"
    state: present
  with_items:
    - { key: "binding", value: "{{ urxvt_shorcut_keys }}" }
    - { key: "command", value: "'gnome-terminal -- {{ urxvt_directory | regex_replace('~', ansible_env.HOME) }}/urxvtopen'" }
    - { key: "name", value: "{{ urxvt_shorcut_name }}" }

- name: copy urxvt configuration
  template:
    src: "Xresources.j2"
    dest: "~/.Xresources"
    mode: 0600
