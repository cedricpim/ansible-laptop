---
- name: "install network tools"
  pacman:
    name: "{{ item }}"
    state: present
  with_items:
    - "iw"
    - "wpa_supplicant"
    - "networkmanager"
    - "ntp"
    - "openresolv"
  become: yes

- name: "copy resolvconf configuration"
  template:
    src: "resolvconf/resolvconf.conf.j2"
    dest: "/etc/resolvconf.conf"
    mode: "0644"
  become: yes
  notify: "rebuild resolvconf configuration"

- name: "create folder for NetworkManager configuration"
  file:
    path: "{{ network_manager_directory }}"
    state: "directory"
    mode: "0755"
  become: yes

- name: "copy NetworkManager configuration"
  template:
    src: "NetworkManager/01-config-dns.conf.j2"
    dest: "{{ network_manager_directory }}/01-config-dns.conf"
    mode: "0644"
  become: yes
  notify: "reload NetworkManager configuration"

- name: "enable/start service for NTP"
  systemd:
    name: "ntpd"
    state: "started"
    enabled: yes
  become: yes

- name: "connect to WI-FI"
  block:
    - command: "ip link set {{ network_interface }} up"
    - command: "wpa_supplicant -B -i {{ network_interface }} -C <(wpa_passphrase {{ network_name }} {{ network_passphrase }})"
    - command: "dhcpcd {{ network_interface }}"
  become: yes
  when:
    - network_interface is defined
    - network_name is defined
    - network_passphrase is defined
