---
- name: "Install network tools"
  pacman:
    name:
      - "iw"
      - "iwd"
      - "bluez"
      - "ntp"
      - "openresolv"
      - "wpa_supplicant"
      - "whois"
      - "nm-connection-editor"
      - "network-manager-applet"
    state: "present"
  become: yes

- name: "Remove current networkmanager"
  pacman:
    name: 
      - "networkmanager"
      - "libnm"
    state: "absent"
  become: yes

- include_role:
    name: "yay"
  vars:
    pkg_name: "networkmanager-iwd"

- name: "Copy resolvconf configuration"
  template:
    src: "resolvconf/resolvconf.conf.j2"
    dest: "/etc/resolvconf.conf"
    mode: "0644"
  become: yes
  notify: "Rebuild resolvconf configuration"

- name: "Enable/start service for IWD"
  systemd:
    name: "iwd"
    state: "started"
    enabled: yes
  become: yes

- name: "Enable/start service for NetworkManager"
  systemd:
    name: "NetworkManager"
    state: "started"
    enabled: yes
  become: yes

- name: "Enable/start service for NTP"
  systemd:
    name: "ntpd"
    state: "started"
    enabled: yes
  become: yes

- import_tasks: "mullvad.yml"
- import_tasks: "openvpn.yml"
