---
- name: "Install network tools"
  pacman:
    name:
      - "iw"
      - "wpa_supplicant"
      - "networkmanager"
      - "ntp"
      - "openresolv"
      - "wireguard-dkms"
      - "wireguard-tools"
      - "linux-headers"
    state: "present"
  become: yes

- include_role:
    name: "zsh"
    tasks_from: "scripts"
  vars:
    script: "wgq"

- name: "Copy resolvconf configuration"
  template:
    src: "resolvconf/resolvconf.conf.j2"
    dest: "/etc/resolvconf.conf"
    mode: "0644"
  become: yes
  notify: "Rebuild resolvconf configuration"

- name: "Create folder for NetworkManager configuration"
  file:
    path: "{{ network_manager_directory }}"
    state: "directory"
    mode: "0755"
  become: yes

- name: "Copy NetworkManager configuration"
  template:
    src: "NetworkManager/01-config-dns.conf.j2"
    dest: "{{ network_manager_directory }}/01-config-dns.conf"
    mode: "0644"
  become: yes
  notify: "Reload NetworkManager configuration"

- name: "Enable/start service for NTP"
  systemd:
    name: "ntpd"
    state: "started"
    enabled: yes
  become: yes

- name: "Connect to WI-FI"
  block:
    - command: "ip link set {{ network_interface }} up"
    - command: "wpa_supplicant -B -i {{ network_interface }} -C <(wpa_passphrase {{ network_name }} {{ network_passphrase }})"
    - command: "dhcpcd {{ network_interface }}"
  become: yes
  when:
    - network_interface is defined
    - network_name is defined
    - network_passphrase is defined
