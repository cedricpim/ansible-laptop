---
- name: ensure zprezto is cloned and up-to-date
  git:
    repo: "{{ zprezto_repo }}"
    dest: "{{ zprezto_dest }}"
    clone: yes
    update: yes
    recursive: yes
  register: cloned_zprezto

- name: pull zprezto submodules
  command: "git submodule update --init --recursive"
  args:
    chdir: "{{ zprezto_dest }}"
  when: cloned_zprezto is defined and cloned_zprezto.submodules_changed is defined

- include_role:
    name: dotfiles
    tasks_from: symlink
  vars:
    src: "{{ zsh_directory }}"
    create_directory: no

- include_role:
    name: dotfiles
    tasks_from: symlink
  vars:
    src: "{{ shell_directory }}"
    create_directory: yes
