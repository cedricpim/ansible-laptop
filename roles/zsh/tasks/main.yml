---
- name: "Install zsh"
  pacman:
    name:
      - "zsh"
      - "zsh-completions"
    state: "present"
  become: yes

- name: "Change default shell to zsh"
  user:
    name: "{{ user }}"
    shell: "/usr/bin/zsh"
  become: yes

- name: "Copy dircolors configuration file"
  template:
    src: "dircolors.j2"
    dest: "~/.dircolors"
    mode: "0600"

- name: "Copy zshenv general environment variables file"
  template:
    src: "zsh/zshenv.etc.j2"
    dest: "/etc/zsh/zshenv"
    mode: "0644"
  become: yes

- name: "Copy p10k configuration file"
  template:
    src: "p10k.zsh.j2"
    dest: "~/.config/zsh/p10k.zsh"
    mode: "0600"

- include_role:
    name: "yay"
  vars:
    pkg_name: "zsh-autosuggestions"

- import_tasks: "configurations.yml"
- import_tasks: "ripgrep.yml"

- include_tasks: "scripts.yml"
  with_items:
    - "pserver-stats"
    - "pserver"
    - "upload"
  loop_control:
    loop_var: "script"
  when: server is defined and server
