#
##  {{ ansible_managed }}
#

# Credits to Miha Rekar: http://mr.si/posts/2016/01/29/dont-screw-up-when-you-ssh-to-production/

if [[ "$TERM" == "screen-256color" ]]; then
  function change-color() {
    if [[ -n "$TMUX" ]] && [[ -n "$1" ]] && [[ -n "$2" ]]; then
      tmux select-pane -P "bg=$1"
      tmux select-pane -P "fg=$2"
    else
      echo -e "\033]11;$1\007\033]10;$2\007"
    fi
  }
  function original-color() {
    if [ -n "$DISPLAY" ]; then
      xrdb -query | grep $1 | sed -r 's/.*:\s*(.+)/\1/'
    fi
  }

  function reset-colors() {
    if [[ -z "$WORK" ]] || [[ ! -n "$TMUX" ]]; then
      change-color "$(original-color '*.background')" "$(original-color '*.foreground')"
    fi
  }

  function colorssh() {
    if [[ "$1" =~ "^ssh " ]]; then
      if [[ "$*" =~ "web*|jobs*|db*|production|ec2-.*compute-1" ]]; then
        change-color '#804235' '#ffffff'
      fi
    else
      reset-colors
    fi
  }

  autoload -U add-zsh-hook
  add-zsh-hook precmd  reset-colors
  add-zsh-hook preexec colorssh
fi
