{{ ansible_managed | comment }}

#
# Executes commands at login post-zshrc.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Execute code that does not affect the current session in the background.
{
  # Compile the completion dump to increase startup speed.
  zcompdump="${ZDOTDIR:-$HOME}/.zcompdump"
  if [[ -s "$zcompdump" && (! -s "${zcompdump}.zwc" || "$zcompdump" -nt "${zcompdump}.zwc") ]]; then
    zcompile "$zcompdump"
  fi
} &!

# Print a random, hopefully interesting, adage.
#if (( $+commands[fortune] )); then
#  fortune -a
#  print
#fi

# Display system information on login
if [ `command -v neofetch` ]; then neofetch; fi

# Start always on tmux existing session
if [ -z "$TMUX" ]; then tmux attach > /dev/null 2>&1; fi

if tmux info &> /dev/null; then
  # Kill the first session created from tmux-resurrect
  # See: https://github.com/tmux-plugins/tmux-resurrect/issues/101
  if [ ! $(tmux list-sessions | wc -l) -eq 1 ] && $(tmux list-sessions | grep -q "^[0-9][0-9]*:"); then
    tmux kill-session -t "$(tmux list-sessions | grep -o '^[0-9][0-9]*:')"
  fi
fi
