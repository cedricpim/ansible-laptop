---
- name: install pacaur dependencies
  pacman:
    name: "{{ item }}"
    state: present
  with_items:
    - expac
    - yajl
    - sudo
    - git

- name: check if pacaur is installed
  command: "pacman -Q pacaur"
  failed_when: false
  changed_when: aur_pacaur_check.rc != 0
  register: aur_pacaur_check

- name: "create {{ user_name }} user"
  user:
    name: "{{ user_name }}"
    append: true
    groups: wheel
    state: present
  when: aur_pacaur_check.rc != 0

- import_tasks: cower.yml
  when: aur_pacaur_check.rc != 0

- import_tasks: pacaur.yml
  when: aur_pacaur_check.rc != 0

- name: update pacaur
  command: "pacaur -Syu"
  become_user: "{{ user_name }}"
  register: pacaur_install_result
  changed_when: pacaur_install_result.stdout.find('there is nothing to do') == -1
