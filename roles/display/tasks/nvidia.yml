---
- name: "Install graphic's related packages"
  pacman:
    name:
      - "mesa"
      - "xf86-video-intel"
      - "nvidia"
      - "bbswitch"
      - "ntfs-3g"
    state: "present"
  become: yes

- name: "Install acpilight package"
  pacman:
    name: "acpilight"
    state: "present"
  become: yes

- name: "Add video group to user"
  user:
    name: "{{ item.name }}"
    groups: "video"
    append: yes
    state: "present"
  with_items: "{{ users }}"
  become: yes

- name: "Install bumblebee package"
  pacman:
    name: "bumblebee"
    state: "present"
  become: yes

- name: "Add bumblebee group to user"
  user:
    name: "{{ item.name }}"
    groups: "bumblebee"
    append: yes
    state: "present"
  with_items: "{{ users }}"
  become: yes

- name: "Start service for bumblebee"
  systemd:
    name: "bumblebeed"
    state: "started"
    enabled: yes
  become: yes

- name: "Install geoclue package"
  pacman:
    name: "geoclue2"
    state: "present"
  become: yes

- name: "Create folder for GeoClue2"
  file:
    path: "{{ geoclue_directory }}"
    state: "directory"
    mode: "0755"
  become: yes

- name: "Copy Geoclue configuration"
  template:
    src: "geoclue.conf.j2"
    dest: "{{ geoclue_directory }}/geoclue.conf"
    mode: "0644"
  become: yes
